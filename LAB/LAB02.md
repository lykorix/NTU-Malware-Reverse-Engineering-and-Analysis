# Lab 02

* [name= 劉浩恩 M11015060]


## 1.

### 1.1
使用Process Monitor：

![](https://i.imgur.com/uP40iDc.png)

### 1.2
使用IDA xor search：

![](https://i.imgur.com/xqGhmgQ.png)

IDA Findcrypt、IDA Entropy Plugin 沒有發現異常。

### 1.3
從 WriteFile 開始尋找，sub_401000 即 WriteFile function。

![](https://i.imgur.com/VjwCxfZ.png)

### 1.4
sub_40181F 會呼叫 sub_401739，即 encoding function。

![](https://i.imgur.com/7Yo5Ni8.png)

![](https://i.imgur.com/40meVqE.png)


### 1.5
每 10 秒截取屏幕截圖、對其進行編碼並將其存到文件中。

![](https://i.imgur.com/CdZ7XD7.png)

![](https://i.imgur.com/kukr119.png)


### 1.6
sub_40181F 呼叫 sub_401739，即 encoding function，見1.4。

### 1.7
使用 x32dbg，0040181F位址指令改為 ret，使程式不執行加密。

![](https://i.imgur.com/CUKoVMA.png)

產生螢幕截圖會存下：

![](https://i.imgur.com/gsQH6Ke.png)

### 2.
使用 IDA 發現字串“You passed level1!” 輸入password1後可能會print。可以找到string的用法，發現是 strcmp 比較 input 和 password1 後 print 。

![](https://i.imgur.com/Td27Q9x.png)

設中斷點在 strcmp，執行程式，可以發現存入`[esp+4]`(即password1)之值為：**r0b0RUlez!**

![](https://i.imgur.com/dWC7LBV.png)

使用 IDA 找到另一個scanf：

![](https://i.imgur.com/4y8rclF.png)

接著字串會被傳sub_401547()，該函數會對字串與0x2進行xor，並將其input進行比較。

![](https://i.imgur.com/3AtOB56.png)

使用x32dbg，將指令改為cmp a1,a1，使其每次都能將答案寫入eax。

![](https://i.imgur.com/czgKAU0.png)

查看每次存入eax之值，得到答案：**w3lldone**

![](https://i.imgur.com/2kJ2CM7.png)


###### tags: `malware`
